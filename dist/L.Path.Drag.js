"use strict";L.Path.include({transform:function(t){if(this._renderer){if(t){this._renderer.transformPath(this,t)}else{this._renderer._resetTransformPath(this);this._update()}}return this},_onMouseClick:function(t){if(this.dragging&&this.dragging.moved()||this._map.dragging&&this._map.dragging.moved()){return}this._fireMouseEvent(t)}});"use strict";L.Handler.PathDrag=L.Handler.extend({initialize:function(t){this._path=t;this._matrix=null;this._startPoint=null;this._dragStartPoint=null;this._mapDraggingWasEnabled=false},addHooks:function(){this._path.on("mousedown",this._onDragStart,this);if(this._path._path){L.DomUtil.addClass(this._path._path,"leaflet-path-draggable")}},removeHooks:function(){this._path.off("mousedown",this._onDragStart,this);if(this._path._path){L.DomUtil.removeClass(this._path._path,"leaflet-path-draggable")}},moved:function(){return this._path._dragMoved},_onDragStart:function(t){this._mapDraggingWasEnabled=false;this._startPoint=t.containerPoint.clone();this._dragStartPoint=t.containerPoint.clone();this._matrix=[1,0,0,1,0,0];L.DomEvent.stop(t.originalEvent);L.DomUtil.addClass(this._path._renderer._container,"leaflet-interactive");this._path._map.on("mousemove",this._onDrag,this);this._path.on("mousemove",this._onDrag,this).on("mouseup",this._onDragEnd,this);if(this._path._map.dragging.enabled()){this._mapDraggingWasEnabled=true;this._path._map.dragging.disable()}this._path._dragMoved=false},_onDrag:function(t){var i=t.containerPoint.x;var a=t.containerPoint.y;var n=i-this._startPoint.x;var r=a-this._startPoint.y;if(!this._path._dragMoved&&(n||r)){this._path._dragMoved=true;this._path.fire("dragstart");this._path.bringToFront()}this._matrix[4]+=n;this._matrix[5]+=r;this._startPoint.x=i;this._startPoint.y=a;this._path.transform(this._matrix);this._path.fire("drag");L.DomEvent.stop(t.originalEvent)},_onDragEnd:function(t){if(this.moved()){this._transformPoints(this._matrix);this._path._project();this._path.transform(null)}this._path._map.off("mousemove",this._onDrag,this);this._path.off("mousemove",this._onDrag,this).off("mouseup",this._onDragEnd,this);this._path.fire("dragend",{distance:Math.sqrt(L.LineUtil._sqDist(this._dragStartPoint,t.containerPoint))});this._matrix=null;this._startPoint=null;this._dragStartPoint=null;if(this._mapDraggingWasEnabled){this._path._map.dragging.enable()}},_transformPoints:function(t){var i=this._path;var a,n,r;var s=L.point(t[4],t[5]);var e=i._map.options.crs;var o=e.transformation;var h=e.scale(i._map.getZoom());var _=e.projection;var d=o.untransform(s,h).subtract(o.untransform(L.point(0,0),h));i._bounds=new L.LatLngBounds;if(i._point){i._latlng=_.unproject(_.project(i._latlng)._add(d));i._point._add(s)}else if(i._rings||i._parts){var g=i._rings||i._parts;var l=i._latlngs;if(!L.Util.isArray(l[0])){l=[l]}for(a=0,n=g.length;a<n;a++){for(var f=0,p=g[a].length;f<p;f++){r=l[a][f];l[a][f]=_.unproject(_.project(r)._add(d));i._bounds.extend(l[a][f]);g[a][f]._add(s)}}}i._updatePath()}});L.Path.addInitHook(function(){if(this.options.draggable){if(this.dragging){this.dragging.enable()}else{this.dragging=new L.Handler.PathDrag(this);this.dragging.enable()}}else if(this.dragging){this.dragging.disable()}});L.SVG.include({_resetTransformPath:function(t){t._path.setAttributeNS(null,"transform","")},transformPath:function(t,i){t._path.setAttributeNS(null,"transform","matrix("+i.join(" ")+")")}});L.SVG.include(!L.Browser.vml?{}:{_resetTransformPath:function(t){if(t._skew){t._skew.on=false;t._path.removeChild(t._skew);t._skew=null}},transformPath:function(t,i){var a=t._skew;if(!a){a=L.SVG.create("skew");t._path.appendChild(a);a.style.behavior="url(#default#VML)";t._skew=a}var n=i[0].toFixed(8)+" "+i[1].toFixed(8)+" "+i[2].toFixed(8)+" "+i[3].toFixed(8)+" 0 0";var r=Math.floor(i[4]).toFixed()+", "+Math.floor(i[5]).toFixed()+"";var s=this._path.style;var e=parseFloat(s.left);var o=parseFloat(s.top);var h=parseFloat(s.width);var _=parseFloat(s.height);if(isNaN(e))e=0;if(isNaN(o))o=0;if(isNaN(h)||!h)h=1;if(isNaN(_)||!_)_=1;var d=(-e/h-.5).toFixed(8)+" "+(-o/_-.5).toFixed(8);a.on="f";a.matrix=n;a.origin=d;a.offset=r;a.on=true}});L.Util.trueFn=function(){return true};L.Canvas.include({_resetTransformPath:function(t){if(!this._containerCopy){return}delete this._containerCopy;if(t._containsPoint_){t._containsPoint=t._containsPoint_;delete t._containsPoint_;this._requestRedraw(t);this._draw(true)}},transformPath:function(t,i){var a=this._containerCopy;var n=this._ctx;if(!a){a=this._containerCopy=document.createElement("canvas");a.width=this._container.width;a.height=this._container.height;t._removed=true;this._redraw();a.getContext("2d").translate(this._bounds.min.x,this._bounds.min.y);a.getContext("2d").drawImage(this._container,0,0);this._initPath(t);t._containsPoint_=t._containsPoint;t._containsPoint=L.Util.trueFn}n.save();n.clearRect(0,0,a.width,a.height);n.drawImage(this._containerCopy,0,0);n.transform.apply(this._ctx,i);var r=this._layers;this._layers={};this._initPath(t);t._updatePath();this._layers=r;n.restore()}});